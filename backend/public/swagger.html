<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StudySync API Documentation</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui.css"
    />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Poppins", sans-serif;
      }
      .topbar {
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        ) !important;
      }
      .swagger-ui .topbar-wrapper .link {
        color: white !important;
        font-weight: 600;
      }
      .swagger-ui .info .title {
        color: #667eea;
      }
      .swagger-ui .scheme-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }
    </style>
  </head>
  <body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui-standalone-preset.js"></script>
    <script>
      window.onload = () => {
        // Get the base URL dynamically
        const baseUrl = window.location.origin;
        const swaggerUrl = `${baseUrl}/swagger.json`;

        // Try to fetch swagger.json first to validate
        fetch(swaggerUrl)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((spec) => {
            // Initialize Swagger UI with the fetched spec
            window.ui = SwaggerUIBundle({
              spec: spec, // Use spec directly instead of URL
              dom_id: "#swagger-ui",
              presets: [
                SwaggerUIBundle.presets.apis,
                SwaggerUIStandalonePreset,
              ],
              layout: "StandaloneLayout",
              deepLinking: true,
              displayOperationId: false,
              defaultModelsExpandDepth: 1,
              defaultModelExpandDepth: 1,
              docExpansion: "list",
              filter: true,
              showExtensions: true,
              showCommonExtensions: true,
            });
          })
          .catch((error) => {
            console.error("Error loading Swagger spec:", error);
            document.getElementById("swagger-ui").innerHTML = `
              <div style="padding: 50px; text-align: center; font-family: sans-serif;">
                <h2 style="color: #f44336;">⚠️ Failed to Load API Documentation</h2>
                <p style="color: #666; margin: 20px 0;">
                  Could not fetch the API specification from <code>${swaggerUrl}</code>
                </p>
                <p style="color: #666;">Error: ${error.message}</p>
                <button onclick="window.location.reload()" 
                  style="padding: 10px 20px; background: #667eea; color: white; border: none; 
                  border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 20px;">
                  Retry
                </button>
                <br><br>
                <a href="/" style="color: #667eea; text-decoration: none;">
                  ← Back to Home
                </a>
              </div>
            `;
          });
      };
    </script>
  </body>
</html>
